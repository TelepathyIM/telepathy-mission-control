telepathy-mission-control 5.5.0 (2010-05-26)
============================================

The "it's yours provided you take it away today" release.

Dependencies:

* telepathy-glib 0.11.6 is now required
* GLib 2.24 is now required
* D-Bus 0.95 is now required
* dbus-glib 0.82 is now required

Enhancements:

* MC now has a new, smaller plugin API, libmission-control-plugins, which is
  expected to have medium- to long-term API/ABI stability. The API mostly
  mirrors the Telepathy D-Bus API. (smcv/fledermaus)

* accounts now support the ChangingPresence property from telepathy-spec
  0.19.6 (andrunko)

* channel dispatch operations now support the HandleWithTime method from
  telepathy-spec 0.19.6 (ptlo)

* channels can be dispatched before a connection goes CONNECTED, which is
  needed for SASL authentication channels (eeejay)

* compiler warnings are correctly enabled (smcv)

Removals:

* libmcclient is no longer installed as a separate library unless the old
  plugin interface is enabled

* fd.o #26634: the obsolete utility mc-account-convert, for migration from
  Mission Control 4, has been removed

Fixes:

* don't time out channel requests until many hours have passed (sjoerd)

* instead of emitting AccountPropertyChanged signals in time-based batches
  with a small delay, change signals are now grouped into atomic changes (smcv)

* fd.o #24876: no longer reimplements a GLib 2.22 method (smcv)

* fd.o #25122, Debian #556488: link mc-wait-for-name to GLib correctly (jonny)

* fd.o#26597: use TpDebugSender to send debug messages over D-Bus (eeejay)

* don't crash mc-tool when the account name is invalid (wjt)

* fd.o #27015: remove a misleading reference to GConf (tomeu)

* fd.o #27129: update and simplify test/twisted/README (tomeu/smcv)

* fd.o #25684: fix detection of accounts that already exist (Jani Monoses/smcv)

* in libmcclient, don't crash on malformed profiles where a group is missing
  (smcv)

Maemo-specific enhancements:

* added a libaccounts-glib-based account storage backend (fledermaus)

telepathy-mission-control 5.4.2 (2010-05-26)
============================================

The "everyone loves magical re-entrancy" release.

Fixes:

* don't assume that data structures borrowed from a TpConnectionManager remain
  valid after re-entering the main loop, which can cause a segfault on startup
  (smcv)

* fix a memory leak in Claim() (fledermaus)

* fix a failure to check for NULL, and a couple of potential leaks, in mc-tool
  (fledermaus)

telepathy-mission-control 5.4.1 (2010-05-25)
============================================

The "badgers and tigers: only in Cambridge" release.

Fixes:

* set 0 as UserActionTime when HandleWith is used (cassidy)

* make tests pass with more recent telepathy-glib, which can call GetInterfaces
  twice (cassidy)

* don't cache whether we have the Requests interface, which caused one of the
  tests to regress (smcv)

telepathy-mission-control 5.4.0 (2010-04-15)
============================================

The "coffee made without human interaction" release.

Enhancements:

* fd.o #27309: implement the Observer.Recover flag from the forthcoming
  telepathy-spec 0.19.4, which lets activatable observers recover (in a
  best-effort way) after crashing, and lets non-activatable observers catch
  up on active channels (again in a best-effort way) (ptlo)

Fixes:

* fd.o #24875: avoid a dependency on GLib >= 2.22 which was accidentally
  introduced in 5.3.2 (smcv)

* Avoid a dependency on dbus-glib 0.80 (Danni)

* fd.o #25122, Debian #556488: link mc-wait-for-name to GLib properly (Jonny)

* mc-tool: don't crash on invalid account names (wjt)

* Only time out channel requests after 5 hours (Sjoerd)

* Remove a misleading reference to GConf (Tomeu)

* fd.o #27021: fix error propagation when creating accounts with invalid
  properties/parameters (Tomeu)

* Release startup locks even for incomplete accounts, avoiding failure to start
  (fledermaus)

telepathy-mission-control 5.3.2 (2009-11-02)
============================================

The "Flight Of The Living Dead" release.

Enhancements:

* mc-wait-for-name: give up after 5 minutes and exit EX_TEMPFAIL. Also exit
  with EX_UNAVAILABLE (instead of 1) if the session bus doesn't work, EX_USAGE
  (instead of 1) on wrong arguments, and EX_USAGE (instead of g_critical()
  and never terminating) if the requested bus name is not valid (smcv)

* fd.o #23651: strongly prefer the PreferredHandler for a channel request, and
  try dispatching to it even if its HandlerChannelFilters do not indicate that
  it could handle the channel, since this is very useful for clients like
  nautilus-sendto (smcv)

* fd.o#24120: refactor McdDispatcher quite extensively:
  + always have a McdDispatchOperation for each McdDispatcherContext, even if
    no approval is needed
  + migrate the dispatching state machine into the dispatch operation
  + move client logic into McdClientProxy, removing the McdClient struct
  + migrate Client discovery and the client registry into a new class
    McdClientRegistry
  + remove many unused signals
  + use McdDispatcherContext for the plugin API and nothing else
  (smcv)

* McdHandlerMap: operate in terms of TpChannel, not McdChannel, to make the
  code less tightly coupled; watch for channels closing and client crashing
  internally, rather than relying on other modules (smcv)

* Run the regression tests with GLib and GObject warnings set to fatal (smcv)

Fixes:

* fd.o #23687: if all Handlers with BypassApproval fail, notify approvers
  and wait for approval before trying other Handlers (smcv)

* fd.o #24474: notify Observers about channels that were requested without
  going via MC, e.g. by Empathy 2.28.x (smcv)

* fd.o #21003: delay the return from HandleWith until HandleChannels has
  succeeded or failed, and pass on errors; do not consider HandleWith(H) to
  be general approval for the channel to be handled with handlers other
  than H (smcv)

* fd.o #24637: don't emit Finished until the channel dispatch operation has
  really finished (smcv)

* Fix a possible use-after-free when noting that a client has gone away (smcv)

* Avoid re-dispatching a re-requested channel to a different handler (smcv)

* When calling HandleChannels, use the most recent user-action time from among
  all requests that led to this channel, and all HandleWith() calls for this
  channel dispatch operation (smcv)

* Don't call ReloadConfig() on the dbus-daemon (reopening fd.o#23921), to avoid
  triggering fd.o#24350 in dbus-daemon and causing service-activations to
  fail (sjoerd)

* mc_account_conditions_call_when_ready: explain why it's OK to ignore the
  result of mc_iface_call_when_ready_int, which was a Coverity false-positive
  (smcv)

* Consider calls to be potentially-missed if they terminate for reason ERROR,
  even if we're the actor, because that's what happens in Gabble >= 0.8.4
  if the streaming implementation (i.e. telepathy-farsight) discovers that
  none of the candidates work and calls Error() (smcv)

* Fix a race condition in the test account-manager/make-valid.py, which
  would sometimes incorrectly make it fail (smcv)

* Add a regression test for dispatching and requests being delayed while
  waiting for a plugin to make an asynchronous request for permission (smcv)

* Don't leak check_parameters_get_param_cb closure on error (smcv)

* In libmcclient, invoke callbacks for GetAll() in the right order (mardy)

All fixes from stable release 5.2.6 have been incorporated in this release.

telepathy-mission-control 5.3.1 (2009-09-18)
============================================

The "only available in Belgium" release.

Dependencies:

* Python >= 2.5 is now required for compilation
* telepathy-glib >= 0.7.37 is now required

Enhancements:

* Automatically migrate passwords and other secrets from accounts.cfg into the
  GNOME keyring (if enabled and available) on MC startup (jonnylamb)

Fixes:

* Deal with the user's alias in a race-free way by calling GetAliases as well
  as binding to the AliasesChanged signal (smcv/mardy)

* Fix some race conditions in the regression tests (smcv)

* Fix mcd_dispatcher_get_channel_type_usage sometimes counting aborted
  channels, by introducing MCD_CHANNEL_STATUS_ABORTED (mardy)

* If we see too many transitions from CONNECTED to DISCONNECTED state (i.e.
  we get kicked off by the server more than 3 times in 2 minutes), stop
  reconnecting; also, don't reset the exponential backoff until we've been
  connected for 2 minutes. This avoids reconnecting in a tight loop if the
  server lets us connect, then immediately drops our connection. (smcv)

* Fix some minor memory leaks (smcv)

All fixes from stable releases 5.2.4 and 5.2.5 have been incorporated in this
release.

telepathy-mission-control 5.3.0 (2009-09-14)
============================================

The "displatcher" release, starting a new development branch.

Dependencies:

* The GNOME Keyring library is a new optional dependency (only if configured
  with --enable-gnome-keyring=yes or --enable-gnome-keyring=auto).

  If it is enabled, having the library at runtime is required, but having the
  daemon itself is optional - the current plain-text storage will be used for
  passwords if the keyring daemon is not available.

Enhancements:

* fd.o#20903: support the final version of ContactCapabilities, from
  telepathy-spec 0.17.28 (smcv)

* fd.o#22231: add optional gnome-keyring integration. This is off by default,
  but distributions should consider configuring MC with --enable-gnome-keyring
  to get this functionality. (jonnylamb/smcv)

* mc-tool: show full Presence information (sjoerd)

* Use the "mcd" G_LOG_DOMAIN (smcv)

* fd.o#23501: support TpDebugSender (smcv)

* Stop #define'ing g_object_ref, g_object_unref (smcv)

* fd.o#22705: support MC_DEBUG=all (smcv)

Fixes:

* Escape "-" in protocol names in Account names, as required by the Telepathy
  spec (sjoerd)

* fd.o #23818: if HandleChannels fails, try all Handlers in sequence before
  giving up (smcv)

* Refactor client locking in McdDispatcher to be more obviously correct (smcv)

* Don't define macros used in glibc feature-test internals, possibly fixing
  failure to build from source on Debian GNU/kFreeBSD (smcv)

* Fix a reference leak when shooting down an unwanted Connection (wjt/smcv)

* fd.o#23921: force dbus-daemon to re-detect .service files on MC startup,
  as a partial workaround for D-Bus bug fd.o#23925 (George Goldberg)

* fd.o#23935: call AddRequest if appropriate even on clients that match only
  channels with Requested=true, and use requested channels' complete
  properties in preference to the properties that were requested (smcv)

* Make signed values in .client files work instead of g_critical'ing (smcv)

* This release also includes all bugfixes from stable-branch versions up to
  and including 5.2.3.

telepathy-mission-control 5.2.3 (2009-09-10)
============================================

The "Morden, via Bank" release.

Fixes:

* fd.o #23807: even if someone without gconf headers makes the tarball, ship
  the necessary files so people with gconf headers can compile it (smcv)

* Resync what's in git with what's in tarball releases: remove some unused
  source files from git, add more support files to tarballs, and don't
  distribute any generated source in tarballs (smcv)

telepathy-mission-control 5.2.2 (2009-09-07)
============================================

The "St. Pancreas" release.

Enhancements:

* Better debug output under various circumstances, including outputting the
  version number on startup (smcv)

* Add the concept of always-on accounts, which can't be disabled or otherwise
  put offline (smcv)

* Try to set initial presence before calling Connect (smcv)

Fixes:

* fd.o #23778: make sure account details (including passwords) are stored in
  directories readable only by the user. Distributions wanting this fix
  without any other changes should cherry-pick git commits 16c55625,
  2a42ac03, c16f40ec and 3558c3b2 (smcv)

* Replace deprecated g_strcasecmp with g_ascii_strcasecmp (Jonh Wendell)

* Don't close old-style Tubes channels if they can't be dispatched, since
  that closes the new-style StreamTube/DBusTube channels that everyone
  should be using, as a side-effect (smcv)

telepathy-mission-control 5.2.1 (2009-08-26)
============================================

The "secret cake" release.

Enhancements:

* Add change notification in the Compat interface (mardy)

* Make the low-memory check overridable by subclasses (smcv)

* Complete online requests with error on DISCONNECTED -> DISCONNECTED
  transition (i.e. cancellation) (mardy)

* Set the initial connection status reason to Requested, since None_Specified
  usually means "generic error" (mardy)

Fixes:

* fd.o #23509: wait for observers and approvers to finish initial processing
  before letting Claim() finish (smcv)

* Don't allow transition from one transport to another (smcv)

* If a transport plugin stops a connection before RequestConnection has even
  returned, remember that, and disconnect that Connection later when it does
  turn up (smcv)

telepathy-mission-control 5.2.0 (2009-07-30)
============================================

The "too many timeouts, reducing the advertised EDNS UDP packet size to 512
octets" release.

This is the first release of a new 5.2.x stable branch, available in git as
the 'telepathy-mission-control-5.2' branch. Feature development will continue
in the 5.3.x series.

Enhancements:

* Update ContactCapabilities draft to the version in telepathy-spec 0.17.26
  (smcv)

* Add regression tests for Capabilities, and for ContactCapabilities draft 1
  (smcv)

Fixes:

* McdConnection: fix a rare crash if no fallbacks for a presence are
  supported (smcv)

* libmcclient: avoid invoking callback twice if the object is already
  ready (mardy)

telepathy-mission-control 5.1.4 (2009-07-09)
============================================

The "I only came here seeking peas" release.

Dependencies:

* fd.o #22332: GConf is no longer required (if it is not available, then the
  MC 4 to MC 5 migration tool, mc-account-convert, will not be built)

Enhancements:

* fd.o #21378: support connection manager parameters whose value is a single
  byte (smcv)

* Add simple man pages for the daemon and utilities (smcv)

Fixes:

* fd.o #22670: don't assume a client has crashed just because it has lost a
  well-known name (smcv)

* Don't use the AutomaticPresence status from account configuration unless the
  presence type is an online presence (mardy)

* fd.o #22585: remove symbols from libmissioncontrol-server that collide with
  symbols in libmcclient, allowing the telepathy-mission-control daemon to be
  statically linked on platforms that don't want to support plugins (smcv)

telepathy-mission-control 5.1.3 (2009-07-01)
============================================

The "wilting" release.

Enhancements:

* Improve test coverage, including EnsureChannel (smcv)

* In tests, add the ability to test an installed MC binary (installcheck)
  (smcv)

Fixes:

* Make sure that ChannelDispatchOperations emit Finished before they are
  unreffed for the last time (smcv)

* Stop mcd_mission_abort() from implicitly closing channels, meaning that
  when Close() has an extra protocol-level meaning (for instance, when using
  an IRC proxy), we don't respond to connection loss by departing from all
  channels. Instead, explicitly close channels whenever desired (smcv)

* Add API for plugins to destroy channels, close channels with a reason,
  or "forget" (do not dispatch) channels (smcv)

* In situations where channels can't be handled, use Destroy() to terminate
  them, if available (smcv)

* In wait-for-name, initialize error properly if we can't connect to D-Bus
  (smcv)

* In tests, restructure `make check-torture` so it doesn't exceed command-line
  length limits (smcv)

* Use g_file_set_contents to overwrite files (mardy)

telepathy-mission-control 5.1.2 (2009-06-26)
============================================

The "don't cross the stream engines" release.

Dependencies:

* telepathy-glib >= 0.7.32 (or 0.7.33 if you want to run the regression tests)

Enhancements:

* Stop generating duplicate bindings in the daemon for interfaces that are
  now available in telepathy-glib 0.7.32

Fixes:

* Fix a subtle use-after-free that can crash MC if more than 4 distinct
  properties change in a 10ms interval (!)

* Make various fixes to putting accounts online:
  - ConnectAutomatically takes effect immediately
  - Fix a race between loading accounts and requesting channels
  - Never consider accounts to be Valid until they've loaded, meaning that we
    never try to put an account online before we've loaded its parameters (!)
  - Don't connect (automatically or by request) unless the account is Valid
  - Don't connect in order to satisfy a channel request unless the account is
    both Valid and Enabled
  - Allow setting RequestedPresence on disabled accounts, fixing creation of
    accounts that already have a RequestedPresence
  - Improve regression test coverage considerably
  - If an account's parameters change and it becomes Valid, consider putting it
    online
  - If an account becomes enabled after an online presence was requested, try
    to put it online

* Change the default RequestedPresence on startup from UNSET to OFFLINE

* Simplify API for low memory indication

* Delete some unnecessary code from McdMaster, and simplify some redundant code

* Forbid setting AutomaticPresence to a non-online status

* Forbid setting RequestedPresence to a status that can't be set on yourself

* Fix a memory leak and some races in the regression tests

* Turn the daemon into a convenience library so one of the tests can link it
  statically even if it's eventually going to be a shared library, fixing
  make check with --enable-plugins

telepathy-mission-control 5.1.1 (2009-06-16)
============================================

The "Beautiful And Damned" release.

Fixes:

* fd.o #22169: allowed PreferredHandler to be empty when requesting a
  channel (smcv)

* Updated code generation from telepathy-glib and followed the recommendations
  of telepathy-glib 0.7.6's NEWS, fixing some possible assertion
  failures (smcv)

* Ensured that AccountValidityChanged will be emitted if an account is added
  in an already-valid state (smcv)

* fd.o #21377: added support for 64-bit integers, doubles and object paths as
  CM parameters, did some work towards supporting bytes as CM parameters,
  and fixed serialization of large 32-bit unsigned integers and
  deserialization of integers of large magnitude (smcv)

* fd.o #21299: prevented automatic reconnection after Name_In_Use error (smcv)

* fd.o #22201: avoided rewriting accounts.cfg if nothing changed (smcv)

* Ensured that the transport was reset when a Connection disconnected (mardy)

telepathy-mission-control 5.1.0 (2009-06-05)
============================================

The "beta 75 would have been silly" release.

After months of development, this is the first numbered release of Mission
Control 5. We jumped straight to 5.1 in order to use the Linux-style odd/even
versioning seen in the other Telepathy components, so the 5.1.x development
branch will lead to the 5.2.x stable branch.

Changes since Mission Control 4 are too numerous to list here, but here are
the major architectural changes.

The proprietary MissionControl API no longer exists; the daemon is a
telepathy-spec-compliant AccountManager, and also a telepathy-spec-compliant
ChannelDispatcher. Consequences of this include:

* Clients are no longer expected to implement the ChannelHandler interface.
  Instead, they may implement the Observer, Approver and/or Handler interfaces
  specified in telepathy-spec.

* The design of channel dispatching copes better with having multiple user
  interface components installed.

* Accounts' presence, avatar and nickname are now independent (stored
  per-account), allowing for more precise control by UIs.

* Accounts no longer have to belong to a "profile", although they still can
  (albeit only by using a non-standard extension).

Accounts are now stored in a flat file, rather than by abusing GConf. The
included mc-account-convert tool might be able to convert MC 4 accounts to
the MC 5 format, if you're lucky.

libmissioncontrol-server has changed its API and ABI considerably, and is not
yet considered stable in its new form either. It is no longer installed by
default (in a normal configuration it'll just be compiled into the daemon).

libmissioncontrol (based on libtelepathy and also known as
libmissioncontrol-client) no longer exists, and has been replaced by
libmcclient (based on telepathy-glib).

Mission Control 5 is not a drop-in replacement for Mission Control 4, and
cannot be used by Mission-Control-4-based applications like Empathy 2.26
and the Maemo 4 platform. However, both versions can be installed
independently in the same directory prefix, to facilitate porting from one to
the other.

Known regressions since Mission Control 4:

* There is no gnome-keyring integration yet.
* The client and server library APIs are not considered to be stable yet.
